language: cpp
sudo: false
dist: trusty

python:
 - "3.3"

cache:
  ccache: true
  apt: true

env:
  global:
    - USE_CCACHE=1
    - CCACHE_COMPRESS=1
    - CCACHE_MAXSIZE=200M
    - CCACHE_CPP2=1
    - BUILD_SANITIZE_MEMORY=0
    - BUILD_DIR=Build
git:
  depth: 1

branches:
  only:
  - master
  - develop

matrix:
  include:

    # OSX Clang Builds
#    - os: osx
#      osx_image: xcode8.3
#      compiler: clang
#      language: generic
#      env: COMPILER=c++ BUILD_TYPE='Release' CXX=c++ CC=cc

    - os: osx
      osx_image: xcode9
      compiler: clang
      language: generic
      env: COMPILER=c++ BUILD_TYPE='Release' CXX=c++ CC=cc RELEASE_BUILDER=1

    # Linux Clang Builds
    - os: linux
      compiler: clang
      addons: &addons
        apt:
          sources: &sources
            - llvm-toolchain-trusty-3.9
            - llvm-toolchain-trusty-4.0
            - ubuntu-toolchain-r-test
          packages:
            - clang-4.0
            #- clang-5.0
            - g++-5
            - g++-6
            - g++-7
      env: COMPILER=clang++-4.0 BUILD_TYPE='Release' CXX=clang++-4.0 CC=clang-4.0

#    - os: linux
#      compiler: clang
#      addons: *addons
#      env: COMPILER=clang++-5.0 BUILD_TYPE='Release' CXX=clang++-5.0 CC=clang-5.0

    # Linux GCC Builds
    - os: linux
      compiler: gcc
      addons: *addons
      env: COMPILER=g++-5 BUILD_TYPE='Release' CXX=g++-5 CC=gcc-5

    - os: linux
      compiler: gcc
      addons: *addons
      env: COMPILER=g++-6 BUILD_TYPE='Release' CXX=g++-6 CC=gcc-6

    - os: linux
      compiler: gcc
      addons: *addons
      env: COMPILER=g++-7 BUILD_TYPE='Release' CXX=g++-7 CC=gcc-7 DOC_BUILDER=1 RELEASE_BUILDER=1

before_install:
  - travis_retry ./ci/setup-environment.sh
install:
  - travis_retry ./ci/setup-dependencies.sh
before_script:
  - ./ci/prepare-build.sh
script:
  - ./ci/run-build.sh
  - ./ci/run-test.sh
#after_success:
#  - ./ci/run-build-documentation.sh
#
#before_deploy:
#  - ./ci/run-pack-documentation.sh
#  - ./ci/run-pack-release.sh
#
#deploy:
#  - provider: pages
#    skip-cleanup: true
#    github-token: $GITHUB_TOKEN
#    local-dir: ${TRAVIS_BUILD_DIR}/${BUILD_DIR}/docs/html
#    on:
#      branch: master
#      condition: "$DOC_BUILDER=1"
#
#  - provider: releases
#      skip-cleanup: true
#      api_key:
#          secure: YOUR_API_KEY_ENCRYPTED
#      file: ${TRAVIS_BUILD_DIR}/release.zip
#      on:
#        branch: master
#        tags: true
#        condition: "RELEASE_BUILDER=1"
#
#  - provider: releases
#      skip-cleanup: true
#      api_key:
#          secure: YOUR_API_KEY_ENCRYPTED
#      file: ${TRAVIS_BUILD_DIR}/release.zip
#      on:
#        branch: develop
#        tags: true
#        condition: "RELEASE_BUILDER=1"